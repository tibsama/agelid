<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisation des Données Firebase</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js"></script>
    <style>
        body {
            background-color: #1e1e2f;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 {
            margin-bottom: 20px;
        }
        .selectors {
            margin-bottom: 20px;
        }
        select, input {
            padding: 8px;
            margin: 5px;
            font-size: 16px;
        }
        canvas {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Visualisation des Données Firebase</h1>
    <div class="selectors">
        <label for="lineSelector">Ligne :</label>
        <select id="lineSelector" onchange="fetchAndDisplayData()">
            <option value="ligne1">Ligne 1</option>
            <!-- Ajoutez d'autres lignes ici si nécessaire -->
        </select>
        
        <label for="dateSelector">Date :</label>
        <input type="date" id="dateSelector" value="2024-12-02" onchange="fetchAndDisplayData()">
        
        <label for="sectionSelector">Section :</label>
        <select id="sectionSelector" onchange="fetchAndDisplayData()">
            <option value="22h-6h">22h-6h</option>
            <!-- Ajoutez d'autres sections ici si nécessaire -->
        </select>
    </div>

    <canvas id="chartCanvas" width="400" height="200"></canvas>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let chart; // Variable pour le graphique Chart.js

        /**
         * Fonction pour récupérer et afficher les données depuis Firebase
         */
        function fetchAndDisplayData() {
            // Récupérer les sélections utilisateur
            const selectedLine = document.getElementById("lineSelector").value;
            const selectedDate = document.getElementById("dateSelector").value;
            const selectedSection = document.getElementById("sectionSelector").value;

            // Référence à la base de données Firebase
            const dbRef = firebase.database().ref(`${selectedLine}/${selectedDate}/${selectedSection}`);

            dbRef.once("value").then(snapshot => {
                const data = snapshot.val();

                // Vérifier si des données existent
                if (!data) {
                    alert("Aucune donnée disponible pour cette sélection.");
                    return;
                }

                // Préparer les données pour le graphique
                const labels = Object.keys(data);
                const values = Object.values(data);
                const colors = labels.map(() => generateRandomColor());

                // Détruire l'ancien graphique s'il existe
                if (chart) chart.destroy();

                // Créer un nouveau graphique
                const ctx = document.getElementById("chartCanvas").getContext("2d");
                chart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Valeurs",
                            data: values,
                            backgroundColor: colors,
                            borderColor: colors.map(color => color.replace("0.6", "1")),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    color: "white"
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: "white"
                                }
                            },
                            x: {
                                ticks: {
                                    color: "white"
                                }
                            }
                        }
                    }
                });
            }).catch(error => {
                console.error("Erreur lors de la récupération des données :", error);
            });
        }

        /**
         * Génère une couleur aléatoire pour le graphique
         * @returns {string} Une couleur RGBA aléatoire
         */
        function generateRandomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return `rgba(${r}, ${g}, ${b}, 0.6)`;
        }

        // Charger les données par défaut au démarrage
        document.addEventListener("DOMContentLoaded", fetchAndDisplayData);
    </script>
</body>
</html>
